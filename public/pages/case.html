<!DOCTYPE html>
<html lang="el">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Υπηρεσία Αναφορών Whistleblowing">
    <meta name="author" content="Computer Studio">
    <meta name="theme-color" content="#60b11e">
    <link href="/resources/favicon.ico" rel="shortcut icon">
    <title>Υπηρεσία Αναφορών Whistleblowing</title>

    <!-- update the version number as needed -->
    <script defer src="/__/firebase/9.21.0/firebase-app-compat.js"></script>
    <!-- include only the Firebase features as you need -->
    <script defer src="/__/firebase/9.21.0/firebase-app-check-compat.js"></script>
    <script defer src="/__/firebase/9.21.0/firebase-auth-compat.js"></script>
    <!-- <script defer src="/__/firebase/9.21.0/firebase-database-compat.js"></script> -->
    <script defer src="/__/firebase/9.21.0/firebase-firestore-compat.js"></script>
    <!-- <script defer src="/__/firebase/9.21.0/firebase-functions-compat.js"></script> -->
    <!-- <script defer src="/__/firebase/9.21.0/firebase-messaging-compat.js"></script> -->
    <!-- <script defer src="/__/firebase/9.21.0/firebase-storage-compat.js"></script> -->
    <!-- <script defer src="/__/firebase/9.21.0/firebase-analytics-compat.js"></script> -->
    <!-- <script defer src="/__/firebase/9.21.0/firebase-remote-config-compat.js"></script> -->
    <!-- <script defer src="/__/firebase/9.21.0/firebase-performance-compat.js"></script> -->
    <!-- 
      initialize the SDK after all desired features are loaded, set useEmulator to false
      to avoid connecting the SDK to running emulators.
    -->
    <script defer src="/__/firebase/init.js?useEmulator=true"></script>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    
    <link href="/resources/style.css" rel="stylesheet" media="screen">
    <script defer src="/resources/dim.js"></script>
    <script defer src="/resources/script.js"></script>
    <script defer src="/resources/auth.js"></script>
    <script defer src="/resources/db.js"></script>
    
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>


  </head>




  <body>


    <div class="body-container">

    <header id="app-header"></header>
    <script async src="/resources/header.js"></script>






    <main class="is-user">

        <div x-data="{caseDoc:{submitter:{}},caseLoaded:false}" x-init="caseDoc = await DB.fetchCase(App.getParams.caseid);caseLoaded=true;" class="case-frame" id="caseFrame">

            <bootstrap-spinner data-message="Φόρτωση υπόθεσης..." x-show="!caseLoaded"></bootstrap-spinner>
            <template x-if="caseLoaded"><div>

                
                <h1>Yπόθεση: <span x-text="caseDoc.title??caseDoc.id"></span></h1>



                <ul class="nav nav-tabs" id="caseTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                      <button class="nav-link active" id="general-tab" data-bs-toggle="tab" data-bs-target="#general-tab-pane" type="button" role="tab" aria-controls="general-tab-pane" aria-selected="true">Στοιχεία υπόθεσης</button>
                    </li>
                    <li class="nav-item" role="presentation">
                      <button class="nav-link" id="communication-tab" data-bs-toggle="tab" data-bs-target="#communication-tab-pane" type="button" role="tab" aria-controls="communication-tab-pane" aria-selected="false">Επικοινωνία με καταγγέλοντα</button>
                    </li>
                </ul>

                    <!-- General Tab -->
                    <div class="tab-content" id="myTabContent">
                        <div class="tab-pane fade show active" id="general-tab-pane" role="tabpanel" aria-labelledby="general-tab" tabindex="0">
                            <h2>Στοιχεία υπόθεσης</h2>

                            <label class="mt-3" for="status">Κατάσταση υπόθεσης</label>
                            <select x-model="caseDoc.status" class="form-select" id="status" name="status" aria-label="Default select example" required>
                                <option x-show="!caseDoc.status" disabled selected value></option>
                                <option value="initial">Αρχική - Ο υπεύθυνος δεν έχει λάβει γνώση της καταγγελίας</option>
                                <option value="pending">Υπό επεξεργασία - Η υπόθεση έχει γνωστοποιηθεί αλλά δεν έχουν ξεκινήσει ακόμα ενέργειες διερεύνησης</option>
                                <option value="under investigation">Υπο διερεύνηση - Ερευνάται η εγκυρότητα της καταγγελίας</option>
                                <option value="under resolution">Υπο επίλυση - Η υπόθεση έχει διερευνηθεί και γίνονται ενέργειες αποκατάστασης</option>
                                <option value="completed">Ολοκληρώθηκε</option>
                                <option value="rejected">Απορρίφθηκε</option>
                                <option value="cancelled">Ακυρώθηκε</option>
                            </select>
                            <p x-show="caseDoc.status=='initial'" class="alert alert-danger my-1 py-2">Παρακαλώ, αλλάξτε την κατάσταση της υπόθεσης.</p>
                
                            
                            <div class="my-3">
                                <label for="title">Τίτλος υπόθεσης</label>
                                <input x-model="caseDoc.title" type="text" class="form-control" id="title" name="title" placeholder="Τίτλος Υπόθεσης" >
                                <p x-show="!caseDoc.title&&false" class="alert alert-danger my-1 py-2">Παρακαλώ, δώστε έναν σύντομο τίτλο στην υπόθεση.</p>
                                <div class="form-text">
                                    Σύντομος τίτλος ο οποίος θα εμφανίζεται στην αρχική οθόνη των καταγγελιών.
                                </div>
                            </div>
                
                            <hr>
                
                            <h2>Στοιχεία παράβασης</h2>
                
                            <label class="mt-3" for="type">Τύπος παραβίασης</label>
                            <select x-model="caseDoc.type" class="form-select" id="type" name="type" aria-label="Default select example" required>
                                <option x-show="!caseDoc.type" disabled selected value></option>
                                <option value="Οικονομική Παρατυπία">Οικονομική Παρατυπία</option>
                                <option value="Παραβίαση Ασφαλείας Εργασίας">Παραβίαση Ασφαλείας Εργασίας</option>
                                <option value="Περιβαλλοντική Ζημιά">Περιβαλλοντική Ζημιά</option>
                                <option value="Παραβίαση Πνευματικών Δικαιωμάτων">Παραβίαση Πνευματικών Δικαιωμάτων</option>
                                <option value="Διακρίσεις/Παρενόχληση στο Χώρο Εργασίας">Διακρίσεις/Παρενόχληση στο Χώρο Εργασίας</option>
                                <option value="Παράβαση Εταιρικών Πολιτικών">Παράβαση Εταιρικών Πολιτικών</option>
                                <option value="Παράβαση Δεδομένων Ιδιωτικότητας">Παράβαση Δεδομένων Ιδιωτικότητας</option>
                                <option value="Υγειονομικές Παραβάσεις">Υγειονομικές Παραβάσεις</option>
                            </select>
                
                
                
                
                            <div class="my-3">
                                <label for="date">Ημερομηνία παραβίασης (έτος-μήνας-ημέρα)</label>
                                <input x-model="caseDoc.date" readonly type="text" class="form-control" id="date" placeholder="-" >
                            </div>
                
                            <div class="my-3">
                                <label for="place">Τοποθεσία παραβίασης</label>
                                <input x-model="caseDoc.place" readonly type="text" class="form-control" id="place" placeholder="-">
                            </div>
                
                
                            <div class="my-3">
                                <label for="description">Αρχική περιγραφή</label>
                                <textarea x-model="caseDoc.description" readonly class="form-control" id="description" placeholder="Αναλυτική Περιγραφή" rows="5"></textarea>
                            </div>
                
                            <div class="my-3">
                                <label for="fileNames">Αρχεία</label>
                                <input x-model="caseDoc.fileNames" type="text" class="form-control" id="fileNames" placeholder="-" readonly>
                            </div>

                            <hr>

                            <div class="form-check my-1">
                                <input class="form-check-input" type="checkbox" value="" id="informUser" :checked="caseDoc.submitter.email" :disabled="!caseDoc.submitter.email">
                                <label class="form-check-label" for="informUser" value="informUser">
                                  Ενημέρωση καταγγέλοντα μέσω e-mail για τις αλλαγές μετά την αποθήκευση. <span x-show="!caseDoc.submitter.email">(Δεν εφαρμόζεται)</span>
                                </label>
                              </div>
                            
                            <button type="button" class="btn btn-success my-2" x-on:click="DB.updateCase(caseDoc)">Αποθήκευση</button>

                        </div>
                    <!-- General Tab -->



                    <!-- Comminication Tab -->
                    <div class="tab-pane fade" id="communication-tab-pane" role="tabpanel" aria-labelledby="communication-tab" tabindex="0">
                        <h2>Στοιχεία καταγγελίας</h2>
                        <div class="my-3">
                            <label for="submittedAt">Ημ/νία καταγγελίας</label>
                            <input x-model="caseDoc.submittedAt.toDate().toLocaleDateString()" type="text" class="form-control" id="submittedAt" placeholder="Ημ/νία καταγγελίας" readonly>
                        </div>
                        <div class="my-3">
                            <label for="email">E-mail καταγγέλοντα</label>
                            <input x-model="caseDoc.submitter.email" readonly type="text" class="form-control" id="email" placeholder="-">
                        </div>
                        <div class="my-3">
                            <label for="contact">Λοιπά στοιχεία επικοινωνίας</label>
                            <input x-model="caseDoc.submitter.contact" readonly type="text" class="form-control" id="contact" placeholder="-">
                        </div>
            
                        <hr>
            
            
                        <h2>Μηνύματα</h2>

                        <div>
                            <!-- <template x-if="caseDoc.messages.length"><h2>Ιστορικό μηνυμάτων</h2></template> -->
                            <template x-for="message in caseDoc.messages" :key="message.order">
                                <div class="row">
                                    <div class="col-md-2"><p>
                                        <span class="text-muted" x-text="message.role"></span><br>
                                        <span class="text-muted" x-text="message.date.toDate().toLocaleDateString()"></span>
                                    </p></div>
                                    <div class="col-md-10 my-2">
                                        <textarea x-model="message.text" class="form-control" readonly></textarea>
                                    </div>
                                </div>
                            </template>
                        </div>
            
            
                        <div class="my-3">
                            <label for="newMessage">Νέο μήνυμα ή σημείωση</label>
                            <textarea x-model="caseDoc.newMessage" class="form-control" id="newMessage" name="newMessage" placeholder="Νέο μήνυμα" rows="4"></textarea>
                            <div class="form-text">
                                Μετά τη δημοσίευση του μηνύματος, δεν είναι δυνατή η τροποποίηση ή διαγραφή του.
                            </div>
                        </div>
            
                        
                        <button type="button" class="btn btn-success my-2" x-on:click="DB.pushMessage(caseDoc,caseDoc.newMessage)">Δημοσίευση μηνύματος και ενημέρωση καταγγέλοντα </button>
            
                        <hr>
                    </div>
                    <!-- Comminication Tab -->
                </div>  










            <!-- <div x-html="App.whistleToHTMLTable(caseDoc)"></div> -->





        </div></template>

    </div>

    <bootstrap-toast data-id="saved" data-message="Η υπόθεση ενημερώθηκε!"></bootstrap-toast>
    <bootstrap-toast data-id="pushed" data-message="Το μήνυμα αποθηκεύτηκε!"></bootstrap-toast>

    </main>



    <footer>
    </footer>








  

    </div>
  </body>
</html>